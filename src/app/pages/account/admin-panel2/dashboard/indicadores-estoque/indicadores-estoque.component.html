<div class="indicadores-estoque-component">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h5 class="mb-0 fw-bold">
      <i class="bi bi-archive me-2 text-warning"></i>
      Indicadores de Estoque
    </h5>
    <div class="btn-group btn-group-sm" role="group">
      <button
        type="button"
        class="btn"
        [class.btn-warning]="periodo() === 'hoje'"
        [class.btn-outline-warning]="periodo() !== 'hoje'"
        (click)="alterarPeriodo('hoje')"
      >
        Hoje
      </button>
      <button
        type="button"
        class="btn"
        [class.btn-warning]="periodo() === 'semana'"
        [class.btn-outline-warning]="periodo() !== 'semana'"
        (click)="alterarPeriodo('semana')"
      >
        7 dias
      </button>
      <button
        type="button"
        class="btn"
        [class.btn-warning]="periodo() === 'mes'"
        [class.btn-outline-warning]="periodo() !== 'mes'"
        (click)="alterarPeriodo('mes')"
      >
        30 dias
      </button>
      <button
        type="button"
        class="btn"
        [class.btn-warning]="periodo() === 'ano'"
        [class.btn-outline-warning]="periodo() !== 'ano'"
        (click)="alterarPeriodo('ano')"
      >
        Ano
      </button>
    </div>
  </div>

  <div *ngIf="isLoading()" class="text-center py-5">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-3 text-muted">Carregando indicadores...</p>
  </div>

  <div *ngIf="!isLoading() && indicadores(); let dados">
    <!-- Cards de Resumo -->
    <div class="row g-3 mb-4">
      <div class="col-md-3 col-sm-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="text-muted mb-1 small">Valor Total Estoque</h6>
                <h4 class="mb-0 fw-bold">{{ formatarMoeda(dados.valorTotalEstoque) }}</h4>
              </div>
              <div class="badge bg-warning bg-opacity-10 text-warning">
                <i class="bi bi-currency-dollar"></i>
              </div>
            </div>
            <div class="text-muted small">
              {{ dados.quantidadeTotalItens }} itens em estoque
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 col-sm-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="text-muted mb-1 small">Produtos sem Estoque</h6>
                <h4 class="mb-0 fw-bold" [class.text-danger]="dados.produtosSemEstoque > 0">
                  {{ dados.produtosSemEstoque }}
                </h4>
              </div>
              <div class="badge bg-danger bg-opacity-10 text-danger">
                <i class="bi bi-exclamation-triangle"></i>
              </div>
            </div>
            <div class="text-muted small" *ngIf="dados.produtosSemEstoque > 0">
              <i class="bi bi-exclamation-circle"></i> Atenção necessária
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 col-sm-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="text-muted mb-1 small">Produtos Estoque Baixo</h6>
                <h4 class="mb-0 fw-bold" [class.text-warning]="dados.produtosEstoqueBaixo > 0">
                  {{ dados.produtosEstoqueBaixo }}
                </h4>
              </div>
              <div class="badge bg-warning bg-opacity-10 text-warning">
                <i class="bi bi-exclamation-circle"></i>
              </div>
            </div>
            <div class="text-muted small">
              Requer reposição
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 col-sm-6">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="text-muted mb-1 small">Giro de Estoque</h6>
                <h4 class="mb-0 fw-bold">{{ dados.giroEstoque.toFixed(2) }}x</h4>
              </div>
              <div class="badge bg-info bg-opacity-10 text-info">
                <i class="bi bi-arrow-repeat"></i>
              </div>
            </div>
            <div class="text-muted small">
              Rotatividade: {{ dados.rotatividadeMedia.toFixed(2) }}x
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabelas e Gráficos -->
    <div class="row g-4">
      <!-- Produtos Mais Estocados -->
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold">Produtos Mais Estocados</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Produto</th>
                    <th class="text-end">Quantidade</th>
                    <th class="text-end">Valor</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of dados.produtosMaisEstocados; let i = index">
                    <td>
                      <span class="badge bg-warning">{{ i + 1 }}</span>
                    </td>
                    <td>{{ produto.nome }}</td>
                    <td class="text-end">{{ produto.quantidadeEstoque }}</td>
                    <td class="text-end">{{ formatarMoeda(produto.valorEstoque) }}</td>
                  </tr>
                  <tr *ngIf="dados.produtosMaisEstocados.length === 0">
                    <td colspan="4" class="text-center text-muted py-3">
                      Nenhum produto em estoque
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Produtos Menos Estocados -->
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold">Produtos Menos Estocados</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Produto</th>
                    <th class="text-end">Quantidade</th>
                    <th class="text-end">Valor</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of dados.produtosMenosEstocados; let i = index">
                    <td>
                      <span class="badge bg-danger">{{ i + 1 }}</span>
                    </td>
                    <td>{{ produto.nome }}</td>
                    <td class="text-end text-danger fw-bold">{{ produto.quantidadeEstoque }}</td>
                    <td class="text-end">{{ formatarMoeda(produto.valorEstoque) }}</td>
                  </tr>
                  <tr *ngIf="dados.produtosMenosEstocados.length === 0">
                    <td colspan="4" class="text-center text-muted py-3">
                      Nenhum dado disponível
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Estoque por Categoria -->
      <div class="col-md-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold">Estoque por Categoria</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>Categoria</th>
                    <th class="text-end">Quantidade Total</th>
                    <th class="text-end">Valor Total</th>
                    <th class="text-end">Percentual</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of dados.estoquePorCategoria">
                    <td><strong>{{ item.categoriaNome }}</strong></td>
                    <td class="text-end">{{ item.quantidadeTotal }}</td>
                    <td class="text-end">{{ formatarMoeda(item.valorTotal) }}</td>
                    <td class="text-end">{{ formatarPercentual(item.percentual) }}</td>
                  </tr>
                  <tr *ngIf="dados.estoquePorCategoria.length === 0">
                    <td colspan="4" class="text-center text-muted py-3">
                      Nenhum dado disponível
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Produtos Críticos -->
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold text-danger">Produtos Críticos</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th class="text-end">Atual</th>
                    <th class="text-end">Mínimo</th>
                    <th class="text-end">Dias Restantes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let produto of dados.produtosCriticos" class="table-danger">
                    <td><strong>{{ produto.nome }}</strong></td>
                    <td class="text-end text-danger fw-bold">{{ produto.quantidadeAtual }}</td>
                    <td class="text-end">{{ produto.quantidadeMinima }}</td>
                    <td class="text-end">
                      <span class="badge bg-danger">{{ produto.diasRestantes }} dias</span>
                    </td>
                  </tr>
                  <tr *ngIf="dados.produtosCriticos.length === 0">
                    <td colspan="4" class="text-center text-muted py-3">
                      Nenhum produto crítico
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Previsão de Reposição -->
      <div class="col-md-6">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold text-warning">Previsão de Reposição</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>Produto</th>
                    <th class="text-end">Dias para Reposição</th>
                    <th class="text-end">Quantidade Necessária</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of dados.previsaoReposicao">
                    <td><strong>{{ item.produtoNome }}</strong></td>
                    <td class="text-end">
                      <span class="badge bg-warning">{{ item.diasParaReposicao }} dias</span>
                    </td>
                    <td class="text-end fw-bold">{{ item.quantidadeNecessaria }}</td>
                  </tr>
                  <tr *ngIf="dados.previsaoReposicao.length === 0">
                    <td colspan="3" class="text-center text-muted py-3">
                      Nenhuma reposição prevista
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Movimentação de Estoque (Gráfico Simulado) -->
      <div class="col-md-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h6 class="mb-0 fw-semibold">Movimentação de Estoque (Últimos 30 dias)</h6>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-sm mb-0">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th class="text-end">Entradas</th>
                    <th class="text-end">Saídas</th>
                    <th class="text-end">Saldo</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let mov of dados.movimentacaoEstoque.slice(-10)">
                    <td>{{ formatarData(mov.data) }}</td>
                    <td class="text-end text-success">{{ mov.entradas }}</td>
                    <td class="text-end text-danger">{{ mov.saidas }}</td>
                    <td class="text-end fw-bold">{{ mov.saldo }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading() && !indicadores()" class="alert alert-warning">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Não foi possível carregar os indicadores de estoque.
  </div>
</div>

